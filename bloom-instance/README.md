The bloom-instance project creates the infrastructure on which the Bloom services run. This must be deployed once per environment (dev, staging, prod, etc), and should be deployed after the base infra for that environment has been created through the setup project. Note that deployments will fail if the app pipeline has not yet been set up as the service images would not not exist to be run by the compute runtime.

The value of the "repos" output from deploying the setup infra should be used to populate the values for the `image` property for each service.

<!-- Do not edit below this line! -->
<!-- BEGIN_TF_DOCS -->

## Requirements

| Name                                                                     | Version   |
| ------------------------------------------------------------------------ | --------- |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | >= 1.3    |
| <a name="requirement_aws"></a> [aws](#requirement_aws)                   | ~> 4.57.0 |

## Providers

| Name                                             | Version |
| ------------------------------------------------ | ------- |
| <a name="provider_aws"></a> [aws](#provider_aws) | 4.57.1  |

## Modules

| Name                                                                             | Source                    | Version |
| -------------------------------------------------------------------------------- | ------------------------- | ------- |
| <a name="module_albs"></a> [albs](#module_albs)                                  | ./alb                     | n/a     |
| <a name="module_backend_api"></a> [backend_api](#module_backend_api)             | ./service/backend         | n/a     |
| <a name="module_certs"></a> [certs](#module_certs)                               | ./cert                    | n/a     |
| <a name="module_db"></a> [db](#module_db)                                        | ./db                      | n/a     |
| <a name="module_dns"></a> [dns](#module_dns)                                     | ./dns                     | n/a     |
| <a name="module_import_listings"></a> [import_listings](#module_import_listings) | ./cronjob/import-listings | n/a     |
| <a name="module_network"></a> [network](#module_network)                         | ./network                 | n/a     |
| <a name="module_partner_site"></a> [partner_site](#module_partner_site)          | ./service/partner-site    | n/a     |
| <a name="module_public_sites"></a> [public_sites](#module_public_sites)          | ./service/public-site     | n/a     |

## Resources

| Name                                                                                                                                                          | Type        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [aws_ecs_cluster.default](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/ecs_cluster)                                            | resource    |
| [aws_s3_bucket.logging_bucket](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket)                                         | resource    |
| [aws_s3_bucket.public_uploads](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket)                                         | resource    |
| [aws_s3_bucket.secure_uploads](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket)                                         | resource    |
| [aws_s3_bucket.static_content](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket)                                         | resource    |
| [aws_s3_bucket_policy.log_bucket_policy](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_policy)                        | resource    |
| [aws_s3_bucket_policy.public_uploads](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_policy)                           | resource    |
| [aws_s3_bucket_public_access_block.public_uploads](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/s3_bucket_public_access_block) | resource    |
| [aws_caller_identity.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/caller_identity)                                 | data source |
| [aws_elb_service_account.current](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/data-sources/elb_service_account)                         | data source |

## Inputs

| Name                                                                                          | Description                                                                 | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Default | Required |
| --------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------- | :------: |
| <a name="input_albs"></a> [albs](#input_albs)                                                 | Settings for managing ALBs                                                  | <pre>map(object({<br> # See alb/inputs.tf for more info<br> subnet_group = string<br> enable_logging = optional(bool, true)<br> internal = optional(bool)<br><br> # See alb/listeners/inputs.tf for more info<br> listeners = map(object({<br> port = number<br> default_action = optional(string, "404")<br><br> allowed_ips = optional(list(string))<br> allowed_subnets = optional(list(string))<br><br> tls = optional(object({<br> enable = optional(bool, true)<br> default_cert = string<br> additional_certs = optional(list(string))<br> }), {<br> enable = false<br> default_cert = null<br> additional_certs = []<br> })<br> }))<br> }))</pre> | n/a     |   yes    |
| <a name="input_application_name"></a> [application_name](#input_application_name)             | The name for the application deployed                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a     |   yes    |
| <a name="input_aws_region"></a> [aws_region](#input_aws_region)                               | The region to use when deploying regional resources                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a     |   yes    |
| <a name="input_backend_api"></a> [backend_api](#input_backend_api)                            | A service definition for the backend API                                    | `any`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a     |   yes    |
| <a name="input_certs"></a> [certs](#input_certs)                                              | The certificates to use                                                     | <pre>map(object({<br> domain = string<br> auto_validate = optional(bool)<br> alt_names = optional(list(string))<br> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | n/a     |   yes    |
| <a name="input_database"></a> [database](#input_database)                                     | Database settings                                                           | `any`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a     |   yes    |
| <a name="input_dns"></a> [dns](#input_dns)                                                    | Settings for managing DNS zones and records                                 | `any`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a     |   yes    |
| <a name="input_environment"></a> [environment](#input_environment)                            | The stage of the software development lifecycle this deployement represents | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `"dev"` |    no    |
| <a name="input_listings_import_task"></a> [listings_import_task](#input_listings_import_task) | Setting for the "Import Listings" scheduled task                            | `any`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a     |   yes    |
| <a name="input_network"></a> [network](#input_network)                                        | n/a                                                                         | <pre>object({<br> vpc_cidr = string<br><br> # See ./network/inputs.tf for object structure<br> subnet_groups = any<br> })</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | n/a     |   yes    |
| <a name="input_owner"></a> [owner](#input_owner)                                              | The owner of the resources created via these templates                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a     |   yes    |
| <a name="input_partner_site"></a> [partner_site](#input_partner_site)                         | A service definition for the partner site                                   | `any`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a     |   yes    |
| <a name="input_project_id"></a> [project_id](#input_project_id)                               | A unique, immutable identifier for this project                             | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a     |   yes    |
| <a name="input_project_name"></a> [project_name](#input_project_name)                         | A human-readable name for this project. Can be changed if needed            | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | n/a     |   yes    |
| <a name="input_public_sites"></a> [public_sites](#input_public_sites)                         | A list of public portal service definitions                                 | `any`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | n/a     |   yes    |

## Outputs

| Name                                                                                                                                         | Description |
| -------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| <a name="output_cert_validation_records_not_created"></a> [cert_validation_records_not_created](#output_cert_validation_records_not_created) | n/a         |
| <a name="output_default_cluster_name"></a> [default_cluster_name](#output_default_cluster_name)                                              | n/a         |
| <a name="output_network"></a> [network](#output_network)                                                                                     | n/a         |
| <a name="output_urls"></a> [urls](#output_urls)                                                                                              | n/a         |

<!-- END_TF_DOCS -->
